---
title: "ST 558 Project 1"
author: "Thomas Bulick and Eliza Norman"
format: html
editor: visual
---

## Title

```{r}
library(tidyverse)
```

Code for one full dataset should be here, just need to move it into a function now.

```{r}
# I replaced read_delim with read_csv because I think this is the preferred method. didn't see any changes, let me know if you see something is messed up  -EN
data_raw <- read_csv("https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv")
data_clean <- data_raw |>
  select(Area_name,STCOU,ends_with("D")) |>
  rename(area_name = Area_name) |>
  arrange(area_name) |> 
  pivot_longer(cols = ends_with("D"), 
               names_to = "varcode", 
               values_to = "vals") |>
  ###I think this code is set up to convert 1900s/2000s data correctly? But let me know if it looks wonky!
  
  ## looks good to me! -EN
  mutate(year = ifelse(as.numeric(substr(varcode,8,9))>25,as.numeric(substr(varcode,8,9))+1900,as.numeric(substr(varcode,8,9))+2000),measure=substr(varcode,1,7))

countydata <- data_clean |>
  slice(grep(pattern = ", \\w\\w", area_name))|>
  mutate(state = substr(area_name,nchar(area_name)-1,nchar(area_name)))
class(countydata) <- c("county", class(countydata))

statedata <- data_clean |>
  slice(grep(pattern = ", \\w\\w", area_name,invert=TRUE)) |>
  mutate(division = ifelse(area_name %in% c("CONNECTICUT", "MAINE", "MASSACHUSETTS", "NEW HAMPSHIRE", "RHODE ISLAND", "VERMONT"),"1",
                    ifelse(area_name %in% c("NEW JERSEY","NEW YORK","PENNSYLVANIA"),"2",
                    ifelse(area_name %in% c("ILLINOIS","INDIANA","MICHIGAN","OHIO","WISCONSIN"),"3",
                    ifelse(area_name %in% c("IOWA","KANSAS","MINNESOTA","MISSOURI","NEBRASKA","NORTH DAKOTA","SOUTH DAKOTA"),"4",
                    ifelse(area_name %in% c("DELAWARE","FLORIDA","GEORGIA","MARYLAND","NORTH CAROLINA","SOUTH CAROLINA","VIRGINIA","DISTRICT OF COLUMBIA","WEST VIRGINIA"),"5",
                    ifelse(area_name %in% c("ALABAMA","KENTUCKY","MISSISSIPPI","TENNESSEE"),"6",
                    ifelse(area_name %in% c("ARKANSAS","LOUISIANA","OKLAHOMA","TEXAS"),"7",
                    ifelse(area_name %in% c("ARIZONA","COLORADO","IDAHO","MONTANA","NEVADA","NEW MEXICO","UTAH","WYOMING"),"8",
                    ifelse(area_name %in% c("ALASKA","CALIFORNIA","HAWAII","OREGON","WASHINGTON"),"9","ERROR"
                    ))))))))))      

class(statedata) <- c("state", class(statedata))
```




```{r}
function_for_step_1_2 <- function(result){
  longer_data <- result |>
    select(Area_name,STCOU,ends_with("D")) |>
    rename(area_name = Area_name) |>
    arrange(area_name) |> 
    pivot_longer(cols = ends_with("D"), 
                 names_to = "varcode", 
                 values_to = "vals") 
  return(longer_data)
}
function_for_step_3 <- function(longer_data){
  create_date_columns <- longer_data |>
      mutate(year =
               ifelse(as.numeric(substr(varcode,8,9))>25,
                      as.numeric(substr(varcode,8,9))+1900,
                      as.numeric(substr(varcode,8,9))+2000),
             measure=substr(varcode,1,7))
  return(create_date_columns)
}
function_for_steps4_5_6 <- function(create_date_columns){
  countydata <- create_date_columns |>
    slice(grep(pattern = ", \\w\\w", area_name))|>
    mutate(state =
             substr(area_name,nchar(area_name)-1,nchar(area_name)))
  class(countydata) <- c("county", class(countydata))

  statedata <- create_date_columns |>
    slice(grep(pattern = ", \\w\\w", area_name,invert=TRUE)) |>
    mutate(division = ifelse(area_name %in% c("CONNECTICUT", "MAINE", "MASSACHUSETTS", "NEW HAMPSHIRE", "RHODE ISLAND", "VERMONT"),"1",
                      ifelse(area_name %in% c("NEW JERSEY","NEW YORK","PENNSYLVANIA"),"2",
                      ifelse(area_name %in% c("ILLINOIS","INDIANA","MICHIGAN","OHIO","WISCONSIN"),"3",
                      ifelse(area_name %in% c("IOWA","KANSAS","MINNESOTA","MISSOURI","NEBRASKA","NORTH DAKOTA","SOUTH DAKOTA"),"4",
                      ifelse(area_name %in% c("DELAWARE","FLORIDA","GEORGIA","MARYLAND","NORTH CAROLINA","SOUTH CAROLINA","VIRGINIA",
                                              "DISTRICT OF COLUMBIA","WEST VIRGINIA"),"5",
                      ifelse(area_name %in% c("ALABAMA","KENTUCKY","MISSISSIPPI","TENNESSEE"),"6",
                      ifelse(area_name %in% c("ARKANSAS","LOUISIANA","OKLAHOMA","TEXAS"),"7",
                      ifelse(area_name %in% c("ARIZONA","COLORADO","IDAHO","MONTANA","NEVADA","NEW MEXICO","UTAH","WYOMING"),"8",
                      ifelse(area_name %in% c("ALASKA","CALIFORNIA","HAWAII","OREGON","WASHINGTON"),"9","ERROR"))))))))))
  class(statedata) <- c("state", class(statedata))
  return(list(countydata, statedata))
}



# wrapper function attempt - should produce same results as above -EN
my_wrapper <- function(url, default_var_name = area_name){
  # assume URL is in quotes ?
  result <- read_csv(url) |>
    function_for_step_1_2() |>
    function_for_step_3() |>
    function_for_steps4_5_6()
}
result_tibbles <- my_wrapper(url="https://www4.stat.ncsu.edu/~online/datasets/EDU01a.csv")

countyData_Final <- result_tibbles[[1]]
stateData_Final <- result_tibbles[[2]]
```

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.
